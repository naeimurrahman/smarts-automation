<!-- =================================================
     SECTION : LEAD FORM (PRODUCTION READY)
================================================= -->
<section id="lead">
  <div class="container">

    <div class="form-wrap">

      <!-- Header -->
      <h2 class="form-title">Get Automation Setup</h2>
      <p class="form-sub">We will contact you shortly</p>

      <!-- ================= FORM ================= -->
      <form id="leadForm">

        <!-- ===== STEP 1 ===== -->
        <div class="step active">
          <input type="text" id="name" placeholder="Full Name" required>
          <input type="email" id="email" placeholder="Email Address" required>
          <button type="button" class="btn" onclick="nextStep()">Continue</button>
        </div>

        <!-- ===== STEP 2 ===== -->
        <div class="step">

          <!-- WhatsApp Field -->
          <div class="wa-section">

            <label class="wa-label">WhatsApp Number</label>

            <div class="wa-field">
              <div class="wa-country" id="waCountryBtn">ðŸ‡§ðŸ‡© +880</div>
              <input
                id="waNumber"
                type="tel"
                inputmode="numeric"
                placeholder="Enter WhatsApp number"
                required
              >
            </div>

            <div class="wa-error" id="waError"></div>
            <input type="hidden" name="whatsapp" id="waFinal">

            <!-- Country Dropdown -->
            <div class="wa-dropdown" id="waDropdown">
              <input type="text" id="waSearch" placeholder="Search country">
              <div class="wa-list" id="waList"></div>
            </div>

          </div>

          <div class="nav">
            <button type="button" class="ghost" onclick="prevStep()">Go back</button>
            <button type="button" class="btn" onclick="nextStep(true)">Continue</button>
          </div>
        </div>

        <!-- ===== STEP 3 ===== -->
        <div class="step">
          <select id="business" required>
            <option value="">Select Business Type</option>
            <option>Agency</option>
            <option>E-commerce</option>
            <option>Service Provider</option>
            <option>Local Business</option>
            <option>Personal Brand</option>
          </select>

          <textarea id="message" placeholder="Message / Requirement"></textarea>

          <div class="nav">
            <button type="button" class="ghost" onclick="prevStep()">Go back</button>
            <button type="submit" class="btn">Submit Request</button>
          </div>
        </div>

      </form>

    </div>
  </div>

  <!-- ================= CSS ================= -->
  <style>
  .form-wrap{
    max-width:520px;
    margin:auto;
    background:#fff;
    padding:36px;
    border-radius:22px;
    box-shadow:0 25px 60px rgba(0,0,0,.08);
  }
  .form-title{
    text-align:center;
    margin-bottom:6px;
  }
  .form-sub{
    text-align:center;
    color:#64748b;
    margin-bottom:20px;
  }
  .form-wrap input,
  .form-wrap select,
  .form-wrap textarea{
    width:100%;
    padding:14px;
    margin-bottom:14px;
    border-radius:10px;
    border:1px solid #e5e7eb;
    font-size:15px;
  }
  .step{display:none}
  .step.active{display:block}
  .nav{
    display:flex;
    gap:10px;
  }
  .ghost{
    flex:1;
    background:#e5e7eb;
    border:none;
    border-radius:10px;
    padding:14px;
    cursor:pointer;
  }

  /* WhatsApp */
  .wa-section{position:relative;margin-bottom:10px}
  .wa-label{font-size:14px;margin-bottom:6px;display:block}
  .wa-field{
    display:flex;
    gap:10px;
  }
  .wa-country{
    background:#f1f5f9;
    padding:14px;
    border-radius:10px;
    cursor:pointer;
    white-space:nowrap;
  }
  .wa-field input{flex:1}
  .wa-error{
    font-size:13px;
    color:#dc2626;
    margin-top:6px;
  }
  .wa-dropdown{
    position:absolute;
    top:100%;
    left:0;
    width:100%;
    background:#fff;
    border:1px solid #e5e7eb;
    border-radius:12px;
    margin-top:6px;
    display:none;
    z-index:9999;
  }
  .wa-dropdown input{
    width:100%;
    padding:12px;
    border:none;
    border-bottom:1px solid #e5e7eb;
  }
  .wa-list{
    max-height:260px;
    overflow-y:auto;
  }
  .wa-item{
    padding:10px;
    cursor:pointer;
    font-size:14px;
  }
  .wa-item:hover{background:#f1f5f9}
  </style>

  <!-- ================= JS ================= -->
  <script>
  /* Wizard */
  let step = 0;
  const steps = document.querySelectorAll("#lead .step");
  function updateSteps(){
    steps.forEach((s,i)=>s.classList.toggle("active",i===step));
  }
  function nextStep(checkWA=false){
    if(checkWA && !validateWhatsApp()) return;
    if(step < steps.length-1){ step++; updateSteps(); }
  }
  function prevStep(){
    if(step > 0){ step--; updateSteps(); }
  }
  updateSteps();

  /* WhatsApp Logic */
  const waCountries = [
    {n:"Bangladesh", c:"+880", l:10, f:"ðŸ‡§ðŸ‡©"},
    {n:"India", c:"+91", l:10, f:"ðŸ‡®ðŸ‡³"},
    {n:"United States", c:"+1", l:10, f:"ðŸ‡ºðŸ‡¸"},
    {n:"United Kingdom", c:"+44", l:10, f:"ðŸ‡¬ðŸ‡§"},
    {n:"United Arab Emirates", c:"+971", l:9, f:"ðŸ‡¦ðŸ‡ª"},
    {n:"Pakistan", c:"+92", l:10, f:"ðŸ‡µðŸ‡°"}
  ];

  let waSelected = waCountries[0];

  const waBtn = document.getElementById("waCountryBtn");
  const waNum = document.getElementById("waNumber");
  const waFinal = document.getElementById("waFinal");
  const waError = document.getElementById("waError");
  const waDrop = document.getElementById("waDropdown");
  const waList = document.getElementById("waList");
  const waSearch = document.getElementById("waSearch");

  function renderList(q=""){
    waList.innerHTML="";
    waCountries
      .filter(x => (x.n+x.c).toLowerCase().includes(q.toLowerCase()))
      .forEach(x=>{
        const d=document.createElement("div");
        d.className="wa-item";
        d.textContent=`${x.f} ${x.n} (${x.c})`;
        d.onclick=()=>{
          waSelected=x;
          waBtn.textContent=`${x.f} ${x.c}`;
          waDrop.style.display="none";
          validateWhatsApp();
        };
        waList.appendChild(d);
      });
  }
  renderList();

  waBtn.onclick=()=>{ waDrop.style.display="block"; waSearch.focus(); }
  waSearch.oninput=e=>renderList(e.target.value);

  fetch("https://ipapi.co/json/")
    .then(r=>r.json())
    .then(d=>{
      const found = waCountries.find(x=>x.c === "+"+d.country_calling_code);
      if(found){
        waSelected = found;
        waBtn.textContent = `${found.f} ${found.c}`;
      }
    });

  function validateWhatsApp(){
    waError.textContent="";
    let v = waNum.value.replace(/\D/g,"");
    if(v.startsWith("0")) v = v.slice(1);
    if(v.length !== waSelected.l){
      waError.textContent = "Enter a valid WhatsApp number";
      return false;
    }
    waFinal.value = waSelected.c + v;
    return true;
  }
  waNum.addEventListener("input", validateWhatsApp);
  </script>

</section>
